<html><head>
<title>Fred's Greenhouse</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.2.1/dygraph.min.js" integrity="sha512-j+6RLnV/rO2AvirXbl+yU5JATIllIaxbV7FaSgrMkJLQa231kNXziVpbTe9+np8S6fLYiZt8Ou0JUFT84zuJdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dygraph/2.2.1/dygraph.min.css" integrity="sha512-ctjfqH0cf1ZvsxW1ub4RMXYPxaAbaGN6XPMXFkIRN2V9cRs21C2tL/9e8W9Osm/gv9hCdJNc+E3tLIqINSLSEg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

<style>
  .dygraph-label.dygraph-y2label,.dygraph-axis-label.dygraph-axis-label-y.dygraph-axis-label-y2 {
    color: green;
  }
  .dygraph-label.dygraph-ylabel,.dygraph-axis-label.dygraph-axis-label-y {
    color: blue;
    visibility: hidden;
  }
  .invisible {
    visibility: hidden;
  }
</style>
</head>

<body>
<div id="graphdiv2"
  style="width:90vw; height:80vh; margin: 0 auto;"></div>
<script type="text/javascript">
tempgraph = new Dygraph("graphdiv2", "temperatures.csv", {
  legend: 'always',
  title: 'Greenhouse',
  ylabel: 'Humidity (%)',
  y2label: 'Temperature (C)',
  series : {
            'Temperature': {
              axis: 'y2',
              axisLabelFormatter: function formatTemperature(d) {
                return Math.floor(d);
              }
            }
  }
});

      function formatTemperature(d) {
        return Math.floor(d);
      }
  
  function displaygraph(el) {
    tempgraph.setVisibility(el.id, el.checked);
    if (el.id==0) {
        var axis = document.querySelectorAll('.dygraph-label.dygraph-y2label');
        var labels = document.querySelectorAll('.dygraph-axis-label.dygraph-axis-label-y.dygraph-axis-label-y2');
    }
    if (el.id==1) {
        var axis = document.querySelectorAll('.dygraph-label.dygraph-ylabel');
        var labels = document.querySelectorAll('.dygraph-axis-label.dygraph-axis-label-y');
    }
    console.log("axis->");
    axis.forEach(node => {
      console.log(node);
    });
    console.log("labels->");
    labels.forEach(node => {
      console.log(node);
    });
    axis.forEach((userItem) => {
      userItem.classList.toggle('invisble');
    })
    labels.forEach((userItem) => {
      userItem.classList.toggle('invisble');
    })
  }

  function updategraph() {
  tempgraph.updateOptions({
                  "file": "temperatures.csv"
                });
}

setInterval(updategraph, 300000); // Calls updategraph() every 5 minutes)
</script>
<p style="margin: 0 25;"><b>Display: </b>
  <input type=checkbox id=0 onClick="displaygraph(this)" checked>
  <label for="0"> Temperature</label>
  <input type=checkbox id=1 onClick="displaygraph(this)" checked>
  <label for="1"> Humidity</label>

</p>
</body></html>
